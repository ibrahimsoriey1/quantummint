FROM node:18-alpine

WORKDIR /app

# Install system dependencies for image processing
RUN apk add --no-cache \
    imagemagick \
    ghostscript

# Install nodemon for development
RUN npm install -g nodemon

# Copy package files
COPY package*.json ./

# Install all dependencies (including dev dependencies)
RUN npm install

# Copy source code
COPY src/ ./src/

# Create necessary directories
RUN mkdir -p logs uploads

# Set permissions for uploads directory
RUN chmod 755 uploads

# Expose port
EXPOSE 3005

# Start with nodemon for hot reloading
CMD ["nodemon", "src/server.js"]
